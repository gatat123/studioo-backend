# Railway Deployment Setup Guide

## Project Links
- Railway Project: https://railway.com/project/07c7df00-6cac-4404-9418-444134f717fe
- Backend Service: https://railway.com/project/07c7df00-6cac-4404-9418-444134f717fe/service/ccfd76c1-2ae4-49e5-8c07-3d4c19be385e
- Backend GitHub: https://github.com/gatat123/studioo-backend
- Frontend GitHub: https://github.com/gatat123/Studioo

## Required Environment Variables

### Backend Service (studioo-backend)

```env
# Database (Railway PostgreSQL will auto-generate DATABASE_URL)
DATABASE_URL=<auto-generated-by-railway>

# Authentication
NEXTAUTH_URL=https://<your-backend-service>.railway.app
NEXTAUTH_SECRET=<generate-with: openssl rand -base64 32>
JWT_SECRET=<generate-with: openssl rand -base64 32>

# Server Configuration
PORT=3001
HOSTNAME=0.0.0.0
NODE_ENV=production

# Socket.io Configuration
SOCKET_PORT=3001
SOCKET_PATH=/socket.io

# Storage Configuration
STORAGE_TYPE=local
UPLOAD_DIR=/app/uploads
MAX_FILE_SIZE=10485760

# Admin Configuration
ADMIN_EMAIL=your-email@example.com
ADMIN_DEFAULT_PASSWORD=<change-this-secure-password>

# CORS Configuration (Important!)
CORS_ORIGIN=https://<your-frontend-service>.railway.app
CLIENT_URL=https://<your-frontend-service>.railway.app
```

### Frontend Service (studioo-frontend)

```env
# Backend API URL
NEXT_PUBLIC_API_URL=https://<your-backend-service>.railway.app
NEXT_PUBLIC_SOCKET_URL=https://<your-backend-service>.railway.app

# NextAuth Configuration
NEXTAUTH_URL=https://<your-frontend-service>.railway.app

# Environment
NODE_ENV=production
```

## Setup Steps

### 1. Add PostgreSQL Database to Railway

1. Go to your Railway project
2. Click "New Service" → "Database" → "Add PostgreSQL"
3. Railway will automatically create a `DATABASE_URL` environment variable

### 2. Configure Backend Service

1. Connect GitHub repository:
   - Service Settings → GitHub → Connect `gatat123/studioo-backend`
   - Set branch to `main`

2. Add environment variables:
   - Go to Variables tab
   - Add all variables listed above
   - Replace placeholders with actual values

3. Configure deployment:
   - Build Command: `npm install --legacy-peer-deps && npx prisma generate && npm run build`
   - Start Command: `npx prisma migrate deploy && npm run start`
   - Port: 3001

### 3. Configure Frontend Service

1. Create new service in Railway
2. Connect GitHub repository:
   - Connect `gatat123/Studioo`
   - Set branch to `main`

3. Add environment variables:
   - Add all frontend variables
   - Make sure URLs match your Railway service URLs

4. Configure deployment:
   - Build Command: `npm install --legacy-peer-deps && npm run build`
   - Start Command: `npm run start`
   - Port: 3000

### 4. Generate Secure Secrets

```bash
# Generate NEXTAUTH_SECRET
openssl rand -base64 32

# Generate JWT_SECRET
openssl rand -base64 32
```

### 5. Database Initialization

After deployment, the database will be automatically migrated via the start command.
If you need to run manual migrations:

```bash
# Using Railway CLI
railway run npx prisma migrate deploy

# Or directly in Railway shell
npx prisma migrate deploy
```

### 6. Verify Deployment

1. Check backend health: `https://<backend-url>/api/health`
2. Check Socket.io status: `https://<backend-url>/api/socket`
3. Frontend should load without errors

## Common Issues & Solutions

### Issue: CORS errors
**Solution**: Ensure `CORS_ORIGIN` and `CLIENT_URL` in backend match your frontend URL exactly

### Issue: Database connection failed
**Solution**: Check that `DATABASE_URL` is properly set and PostgreSQL service is running

### Issue: WebSocket connection failed
**Solution**: 
- Verify `NEXT_PUBLIC_SOCKET_URL` in frontend matches backend URL
- Check that port 3001 is properly configured

### Issue: Build fails with Prisma error
**Solution**: Ensure `npx prisma generate` runs in build command

### Issue: Authentication not working
**Solution**: 
- Verify `NEXTAUTH_URL` matches the service URL
- Check that `NEXTAUTH_SECRET` is the same in both services

## Monitoring & Logs

- View logs: Railway Dashboard → Service → Logs
- Monitor metrics: Railway Dashboard → Service → Metrics
- Database queries: Use Railway's database plugin or connect with Prisma Studio

## Useful Railway CLI Commands

```bash
# Link project
railway link

# View logs
railway logs

# Run commands in production
railway run <command>

# Deploy manually
railway up

# View environment variables
railway variables

# Add environment variable
railway variables set KEY=value
```

## Support

For issues specific to:
- Railway deployment: https://docs.railway.app
- Next.js: https://nextjs.org/docs
- Prisma: https://www.prisma.io/docs
- Socket.io: https://socket.io/docs